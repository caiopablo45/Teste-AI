<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Flona Contendas do Sincor√°</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f6f8; }
        
        /* Cart√µes */
        .card { border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-radius: 10px; margin-bottom: 20px; background: white; }
        .card-header { background-color: #004d40; color: white; font-weight: 600; border-radius: 10px 10px 0 0 !important; padding: 12px 20px; }
        
        /* Mapa e Gr√°fico */
        #map { height: 450px; width: 100%; border-radius: 10px; border: 1px solid #ddd; z-index: 1; }
        .chart-container { height: 400px; width: 100%; }
        
        /* KPI */
        .kpi-card { text-align: center; padding: 20px; border-radius: 10px; color: white; background: linear-gradient(135deg, #00695c, #004d40); transition: transform 0.2s; }
        
        /* Cabe√ßalho Verde */
        .header-container { 
            background: #ffffff; 
            padding: 15px 30px; 
            border-bottom: 4px solid #1b5e20; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            margin-bottom: 30px; 
            display: flex; 
            align-items: center; 
            gap: 20px; 
        }
        .header-logo { height: 60px; width: auto; } 
        .header-text h2 { color: #004d40; font-weight: 800; margin: 0; font-size: 1.5rem; }
        .header-text h5 { color: #546e7a; margin: 0; font-weight: 500; font-size: 1rem; }
        
        /* Filtros */
        .filter-box { background: white; padding: 20px; border-radius: 10px; border: 1px solid #eee; }
        .filter-checkbox-group { border: 1px solid #e0e0e0; padding: 12px; border-radius: 8px; background: #f9f9f9; }
        
        /* Tabela */
        #dataTable td.desc-cell { white-space: normal; min-width: 300px; text-align: justify; font-size: 0.9rem; line-height: 1.4; }
        #dataTable th { background-color: #263238; color: white; font-size: 0.85rem; }

        /* Ajustes Mobile */
        @media (max-width: 768px) {
            .header-container { padding: 15px; gap: 10px; }
            .header-logo { height: 45px; }
            .header-text h2 { font-size: 1.1rem; }
            #map { height: 300px; }
            .col-hide-mobile { display: none; }
        }
    </style>
</head>
<body>

<div class="container-fluid px-0">
    <div class="header-container">
        <img src="https://amazoniaprotege.mpf.mp.br/imagens/logo-parceiro-icmbio.png" alt="Logo ICMBio" class="header-logo">
        <div class="header-text">
            <h2>Painel de Autos de Infra√ß√£o</h2>
            <h5>Flona Contendas do Sincor√°</h5>
        </div>
    </div>
</div>

<div class="container-fluid p-3 p-md-4">
    <div id="dashboardContent">
        <div class="row mb-4">
            <div class="col-12">
                <div class="filter-box shadow-sm">
                    <h6 class="fw-bold text-secondary mb-3">FILTROS DE PESQUISA</h6>
                    <div class="row g-3">
                        <div class="col-12 col-md-3">
                            <label class="form-label small fw-bold">Ano de Ocorr√™ncia</label>
                            <select id="filterAno" class="form-select" onchange="updateDashboard()">
                                <option value="">Todos os Anos</option>
                            </select>
                        </div>
                        <div class="col-12 col-md-7">
                            <label class="form-label small fw-bold">Tipos de Infra√ß√£o</label>
                            <div class="filter-checkbox-group d-flex flex-wrap gap-3">
                                <div class="form-check">
                                    <input class="form-check-input type-checkbox" type="checkbox" value="Multa Simples" id="chk1" onchange="updateDashboard()">
                                    <label class="form-check-label" for="chk1">Multa Simples</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input type-checkbox" type="checkbox" value="Suspens√£o" id="chk2" onchange="updateDashboard()">
                                    <label class="form-check-label" for="chk2">Cont√©m Suspens√£o</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input type-checkbox" type="checkbox" value="Apreens√£o" id="chk3" onchange="updateDashboard()">
                                    <label class="form-check-label" for="chk3">Cont√©m Apreens√£o</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-2 d-flex align-items-end">
                            <button onclick="resetFilters()" class="btn btn-outline-secondary w-100">Limpar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12 col-md-4 offset-md-4">
                <div class="kpi-card shadow">
                    <h5 class="mb-1 opacity-75">Total de Autos Localizados</h5>
                    <h1 class="display-3 fw-bold mb-0" id="kpiTotal">0</h1>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header">Evolu√ß√£o Temporal (Produ√ß√£o Anual)</div>
                    <div class="card-body">
                        <div id="chartProdutividade" class="chart-container"></div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="card h-100">
                    <div class="card-header">Distribui√ß√£o Espacial</div>
                    <div class="card-body p-0">
                        <div id="map"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>üìã Detalhamento (Ordem Decrescente)</span>
                        <span class="badge bg-white text-dark border" id="tableCount">0 registros</span>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive" style="max-height: 500px;">
                            <table class="table table-hover table-striped mb-0 table-bordered" id="dataTable">
                                <thead style="position: sticky; top: 0; z-index: 10;">
                                    <tr>
                                        <th style="width: 100px;">N¬∞ AI</th>
                                        <th style="width: 80px;">Ano</th>
                                        <th class="col-hide-mobile" style="width: 200px;">Tipo</th>
                                        <th>Descri√ß√£o Detalhada</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

<script>
    const globalData = [
        { "Ano": "2025", "Numero_AI": "XVVTAL22", "Tipo": "Multa simples/Apreens√£o", "Descricao": "Ter em cativeiro animal silvestre da fauna brasileira (1 papa capim, 1 azul√£o e 1 can√°rio da terra) na Zona de Amortecimento da FLONA Contendas do Sincor√°.", "Latitude": -13.765619, "Longitude": -41.050123 },
        { "Ano": "2023", "Numero_AI": "DN514S90", "Tipo": "Multa Simples", "Descricao": "Ter em dep√≥sito carca√ßas de tr√™s animais silvestres: um tatu peba, um veado (chifre) e um gato mourisco (couro).", "Latitude": -13.789033, "Longitude": -40.992912 },
        { "Ano": "2024", "Numero_AI": "UTHGU2UN", "Tipo": "Multa Simples/Apreens√£o", "Descricao": "Ter em cativeiro cinco p√°ssaros silvestres na varanda de sua casa da Fazenda Alvorada.", "Latitude": -13.868182, "Longitude": -41.133336 },
        { "Ano": "2016", "Numero_AI": "20667", "Tipo": "Multa Simples/Suspens√£o", "Descricao": "Realizar atividade de cria√ß√£o de gado no interior da UC FLONA Contendas do Sincor√°.", "Latitude": -13.882967, "Longitude": -41.093567 },
        { "Ano": "2024", "Numero_AI": "YZMG00N7", "Tipo": "Multa Simples", "Descricao": "Manter quatro c√£es dom√©sticos amarrados, sem cobertura e sem √°gua.", "Latitude": -13.886126, "Longitude": -41.06438 },
        { "Ano": "2019", "Numero_AI": "17162", "Tipo": "Multa Simples/Apreens√£o", "Descricao": "Destruir 0,0217 ha de vegeta√ß√£o nativa dentro da FLONA. Apreens√£o de uma motocicleta.", "Latitude": -13.900469, "Longitude": -41.083047 },
        { "Ano": "2023", "Numero_AI": "O3PO7LP7", "Tipo": "Multa Simples", "Descricao": "Transportar um tatu-peba no interior da FLONA Contendas do Sincor√°.", "Latitude": -13.943278, "Longitude": -41.045194 },
        { "Ano": "2023", "Numero_AI": "RLQJMQYA", "Tipo": "Multa Simples", "Descricao": "Penetrar na FLONA portando uma espingarda calibre 28 e uma carca√ßa de tatu-peba defumada.", "Latitude": -13.943278, "Longitude": -41.045194 },
        { "Ano": "2023", "Numero_AI": "YKYIPWGD", "Tipo": "Multa Simples/Apreens√£o", "Descricao": "Desmatar, a corte raso, floresta de Caatinga, na Zona de Amortecimento da FLONA Contendas do Sincor√°.", "Latitude": -13.976389, "Longitude": -41.033056 },
        { "Ano": "2025", "Numero_AI": "864JK544", "Tipo": "Multa simples", "Descricao": "Ter em dep√≥sito 18 pombas arriba√ßas no congelador de um alojamento funcional", "Latitude": -13.978556, "Longitude": -41.030278 },
        { "Ano": "2017", "Numero_AI": "8768", "Tipo": "Multa Simples/Apreens√£o", "Descricao": "Penetrar em UC, conduzindo subst√¢ncias ou instrumentos pr√≥prios para ca√ßa, sem licen√ßa.", "Latitude": -13.9459, "Longitude": -41.111083 },
        { "Ano": "2023", "Numero_AI": "60UF6A9U", "Tipo": "Multa Simples", "Descricao": "Transportar carca√ßa de veado (chifre) na Zona de Amortecimento da Flona.", "Latitude": -13.9475, "Longitude": -41.156944 },
        { "Ano": "2021", "Numero_AI": "6STI43YO", "Tipo": "Multa Simples", "Descricao": "Danificar 1.43 hectares de floresta nativa, objeto de especial preserva√ß√£o (Bioma Caatinga).", "Latitude": -13.968823, "Longitude": -41.115246 },
        { "Ano": "2023", "Numero_AI": "LX0RQTS0", "Tipo": "Multa Simples", "Descricao": "Ter em dep√≥sito cinco carca√ßas de animais silvestres. Tr√™s porco do mato caititu e dois jacu.", "Latitude": -13.960333, "Longitude": -41.109556 },
        { "Ano": "2024", "Numero_AI": "RWZ3IO4N", "Tipo": "Multa Simples", "Descricao": "Desmatar 06 hectares de vegeta√ß√£o de Caatinga sem autoriza√ß√£o na zona de amortecimento.", "Latitude": -13.997833, "Longitude": -41.143472 },
        { "Ano": "2024", "Numero_AI": "V4JVC2CS", "Tipo": "Multa Simples", "Descricao": "Desmatar 27 hectares de vegeta√ß√£o de Caatinga sem autoriza√ß√£o do √≥rg√£o ambiental.", "Latitude": -13.990167, "Longitude": -41.159917 },
        { "Ano": "2024", "Numero_AI": "3QHYJ5V8", "Tipo": "Multa Simples", "Descricao": "Desmatar 19.3 hectares de vegeta√ß√£o de Caatinga sem autoriza√ß√£o da autoridade.", "Latitude": -13.995528, "Longitude": -41.162306 },
        { "Ano": "2025", "Numero_AI": "2AF84GRE", "Tipo": "Multa simples/Apreens√£o", "Descricao": "Ter em cativeiro esp√©cimes da fauna silvestre (Trinca ferro, Azul√£o, Can√°rio, etc).", "Latitude": -14.016571, "Longitude": -41.244529 },
        { "Ano": "2025", "Numero_AI": "IDTBNYAE", "Tipo": "Multa simples/Apreens√£o", "Descricao": "Ter em cativeiro 12 p√°ssaros silvestres sem autoriza√ß√£o na Zona de Amortecimento.", "Latitude": -14.022287, "Longitude": -41.251311 },
        { "Ano": "2025", "Numero_AI": "09I1AQOI", "Tipo": "Multa simples/Apreens√£o", "Descricao": "Ter em cativeiro esp√©cimes da fauna silvestre (Azul√£o e Galo Campina) na ZA.", "Latitude": -14.022817, "Longitude": -41.250531 },
        { "Ano": "2025", "Numero_AI": "FSKZE11E", "Tipo": "Multa simples/Apreens√£o", "Descricao": "Ter em cativeiro 11 animais silvestres de diversas esp√©cies na ZA.", "Latitude": -14.024758, "Longitude": -41.250542 },
        { "Ano": "2024", "Numero_AI": "MXC5GP1C", "Tipo": "Multa Simples", "Descricao": "Destruir 7.9 Hectares de vegeta√ß√£o de caatinga na Zona de Amortecimento.", "Latitude": -13.891944, "Longitude": -41.110556 },
        { "Ano": "2024", "Numero_AI": "9YJAOQFA", "Tipo": "Multa Simples/Apreens√£o", "Descricao": "Ter em dep√≥sito 02 can√°rios da terra em resid√™ncia na Zona de Amortecimento.", "Latitude": -13.886084, "Longitude": -41.064402 },
        { "Ano": "2018", "Numero_AI": "28124", "Tipo": "Multa Simples", "Descricao": "Causar dano a UC atrav√©s do dep√≥sito irregular de res√≠duo s√≥lido (papel√£o, pl√°stico, etc).", "Latitude": -13.926833, "Longitude": -41.097868 },
        { "Ano": "2024", "Numero_AI": "1V0C7G20", "Tipo": "Multa Simples/Apreens√£o", "Descricao": "Ter em dep√≥sito 18 pombas arriba√ßas Zenaida auriculata no congelador.", "Latitude": -13.978556, "Longitude": -41.030278 },
        { "Ano": "2017", "Numero_AI": "8769", "Tipo": "Multa Simples", "Descricao": "Penetrar na FLONA conduzindo instrumentos pr√≥prios para ca√ßa.", "Latitude": -13.954278, "Longitude": -41.101847 },
        { "Ano": "2012", "Numero_AI": "15952", "Tipo": "Multa Simples", "Descricao": "Danificar 5,659ha de vegeta√ß√£o nativa localizada fora da UC sem aprova√ß√£o.", "Latitude": -13.966722, "Longitude": -41.124444 },
        { "Ano": "2023", "Numero_AI": "4SP69ZIS", "Tipo": "Multa Simples/Apreens√£o", "Descricao": "Penetrar na UC portando instrumento para ca√ßa (Espingarda calibre 32).", "Latitude": -13.960333, "Longitude": -41.109556 },
        { "Ano": "2025", "Numero_AI": "864JK544", "Tipo": "Multa simples", "Descricao": "Ter em dep√≥sito 18 pombas arriba√ßas. Ref. Processo SEI n¬∫ 02125.001400/2024-37.", "Latitude": -13.978556, "Longitude": -41.030278 },
        { "Ano": "2025", "Numero_AI": "GOAMROX6", "Tipo": "Multa simples", "Descricao": "Quebra do embargo K1QE5346, de √°rea de 212 hectares, para pastagem.", "Latitude": -13.976944, "Longitude": -41.031389 }
    ];

    let map, markersLayer;

    function initApp() {
        initFilters();
        initMap();
        updateDashboard();
    }

    function initMap() {
        map = L.map('map').setView([-13.85, -41.10], 9); 
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        markersLayer = L.layerGroup().addTo(map);
    }

    function initFilters() {
        const anos = [...new Set(globalData.map(d => d.Ano))].sort().reverse();
        const selAno = document.getElementById('filterAno');
        anos.forEach(a => selAno.innerHTML += `<option value="${a}">${a}</option>`);
    }

    function resetFilters() {
        document.getElementById('filterAno').value = "";
        document.querySelectorAll('.type-checkbox').forEach(cb => cb.checked = false);
        updateDashboard();
    }

    function updateDashboard() {
        const ano = document.getElementById('filterAno').value;
        const checkboxes = document.querySelectorAll('.type-checkbox:checked');
        const terms = Array.from(checkboxes).map(cb => cb.value.toLowerCase());

        let filtered = globalData.filter(d => {
            const mAno = (ano === "" || d.Ano == ano);
            let mTipo = (terms.length === 0) || terms.some(t => d.Tipo.toLowerCase().includes(t));
            return mAno && mTipo;
        });

        // Tabela: Ordem DECRESCENTE (Mais recente para o mais antigo)
        filtered.sort((a, b) => parseInt(b.Ano) - parseInt(a.Ano));

        document.getElementById('kpiTotal').innerText = filtered.length;
        document.getElementById('tableCount').innerText = filtered.length + " registros";

        updateChart(filtered);
        updateMap(filtered);
        updateTable(filtered);
    }

    function updateChart(data) {
        const counts = {};
        data.forEach(d => { counts[d.Ano] = (counts[d.Ano] || 0) + 1; });
        
        // Gr√°fico: Ordem CRESCENTE (Cronol√≥gica da esquerda para a direita)
        const x = Object.keys(counts).sort(); 
        const y = x.map(k => counts[k]);

        Plotly.newPlot('chartProdutividade', [{
            x: x, y: y, type: 'bar', marker: {color: '#1b5e20'},
            text: y.map(String), textposition: 'auto'
        }], {
            margin: {t: 20, l: 40, r: 20, b: 40},
            xaxis: {type: 'category', title: 'Linha do Tempo (Anos)'},
            yaxis: {title: 'Quantidade'}
        }, {responsive: true, displayModeBar: false});
    }

    function updateMap(data) {
        markersLayer.clearLayers();
        const bounds = L.latLngBounds();
        let hasPoints = false;
        data.forEach(d => {
            if(d.Latitude && d.Longitude) {
                const m = L.marker([d.Latitude, d.Longitude]).bindPopup(`<b>AI: ${d.Numero_AI}</b><br>Ano: ${d.Ano}<hr>${d.Descricao}`);
                markersLayer.addLayer(m);
                bounds.extend([d.Latitude, d.Longitude]);
                hasPoints = true;
            }
        });
        if(hasPoints) map.fitBounds(bounds, {padding: [30, 30]});
    }

    function updateTable(data) {
        const tbody = document.querySelector('#dataTable tbody');
        tbody.innerHTML = '';
        data.forEach(d => {
            tbody.insertAdjacentHTML('beforeend', `<tr>
                <td class="fw-bold text-primary">${d.Numero_AI}</td>
                <td>${d.Ano}</td>
                <td class="col-hide-mobile"><span class="badge bg-light text-dark border">${d.Tipo}</span></td>
                <td class="desc-cell">${d.Descricao}</td>
            </tr>`);
        });
    }

    document.addEventListener('DOMContentLoaded', initApp);
</script>

</body>
</html>
